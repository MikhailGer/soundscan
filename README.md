# SoundScan Project

## Описание проекта

**SoundScan** — это приложение для управления оборудованием и проведения измерений на основе Python и Qt. Программа включает несколько модулей для работы с базой данных, взаимодействия с Arduino и обработки данных измерений. В проекте используются **SQLAlchemy** для взаимодействия с базой данных, **PyQt** для создания графического интерфейса и **QSerialPort** для работы с последовательными портами Arduino.

## Основные используемые библиотеки

- **PyQt5** — создание графического интерфейса.
- **SQLAlchemy** — взаимодействие с базой данных.
- **alembic** — управление миграциями базы данных.
- **psycopg2** — драйвер для подключения к базе данных PostgreSQL.
- **PyQt5.QtSerialPort** — работа с последовательными портами для подключения к Arduino.
- **Pydantic** — управление конфигурацией приложения и переменными окружения.
- **logging** — ведение логов для мониторинга работы и отладки.

## Структура проекта

```
soundscan/
├── alembic/                # Миграции базы данных
│   ├── versions/           # Файлы миграций
│   └── alembic.ini         # Конфигурация Alembic
├── src/
│   ├── arduino/            # Модули для работы с Arduino
│   │   ├── arduino_controller.py
│   │   ├── arduino_checker.py
│   │   ├── measurement_controller.py
│   │   ├── port_checker.py
│   │   ├── serial_port_worker.py
│   │   └── serial_thread.py
│   ├── config.py           # Конфигурация приложения
│   ├── db.py               # Настройка подключения к базе данных
│   ├── main.py             # Стартовый файл приложения
│   └── windows/            # Модули и логика отдельных вкладок интерфейса
│       ├── change_history.py
│       ├── devise_config.py
│       ├── disk_type.py
│       ├── model_training.py
│       └── new_measurement.py
├── .env                    # Переменные окружения
└── README.md               # Документация проекта
```

## Установка и настройка

### 1. Клонирование репозитория

```bash
git clone https://github.com/your-repository/soundscan.git
cd soundscan
```

### 2. Создание и активация виртуального окружения

```bash
python3 -m venv venv
source venv/bin/activate  # Для Windows: venv\Scripts\activate
```

### 3. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 4. Настройка переменных окружения

Создайте файл `.env` в корне проекта и добавьте настройки:

```
DB_URL=postgresql://username:password@localhost:5432/soundscan_db
DB_SCHEMA=soundscan
```

### 5. Инициализация базы данных

Если база данных PostgreSQL не настроена, создайте её:

1. **Создайте базу данных `soundscan_db`**:

```sql
CREATE DATABASE soundscan_db;
```

2. **Создайте схему `soundscan` в базе данных `soundscan_db`**:

```sql
\c soundscan_db;  -- Подключаемся к базе данных soundscan_db
CREATE SCHEMA soundscan;  -- Создаем схему soundscan
```

3. **Примените миграции Alembic**:

```bash
alembic upgrade head
```

Это создаст все необходимые таблицы и структуру в схеме `soundscan`.

### 6. Запуск приложения

```bash
python3 src/main.py
```

## Логика работы приложения

### Основные модули и их функционал

1. **`main.py`**: основной файл приложения, который создает главное окно и инициализирует все модули.
   
2. **Модули для работы с Arduino**:
   - `arduino_controller.py`: управление устройством Arduino, автоподключение, взаимодействие с последовательным портом.
   - `arduino_checker.py`: отслеживание состояния подключения к устройству.
   - `measurement_controller.py`: контроль процесса измерений, запуск и остановка работы, обработка данных.
   - `port_checker.py`: сканирование доступных портов для подключения устройства.
   - `serial_port_worker.py`: работа с последовательным портом через сигнал-слоты.
   - `serial_thread.py`: управление потоком работы с последовательным портом.

3. **Модули вкладок**:
   - `change_history.py`: логика работы вкладки "История изменений", отображение истории измерений и контроль данных.
   - `devise_config.py`: работа с вкладкой "Параметры устройства", загрузка и сохранение конфигурации.
   - `disk_type.py`: управление типами дисков, добавление и удаление типов.
   - `model_training.py`: логика для работы с обучением моделей, выбор и управление тренировочными данными.
   - `new_measurement.py`: логика новой вкладки измерений, контроль за измерениями и отображение результатов.

### Логика работы с Arduino
1. **Подключение**:
   - Автоматическое определение доступных портов.
   - Если порт сохранен в базе данных, приложение пытается подключиться к нему.
   - Если подключение не удалось, сканируются все доступные порты.

2. **Взаимодействие**:
   - Процедура handshake — подтверждение готовности устройства к работе.
   - Прием и обработка данных с устройства через сигналы PyQt.

3. **Измерения**:
   - Старт измерений по команде из интерфейса.
   - Обработка данных и отображение результатов в реальном времени.
   - Возможность экстренной остановки и возобновления процесса.

### Вкладка "История измерений"
- Отображает все предыдущие измерения для выбранного типа диска.
- Возможность выбора измерений и анализа результатов.

### Вкладка "Типы дисков"
- Управление типами дисков, добавление и удаление элементов.
- Изменение параметров дисков, таких как диаметр и расстояние между лопатками.

### Вкладка "Параметры устройства"
- Отображает и сохраняет текущие параметры конфигурации устройства.
- Подключение к устройству через последовательный порт.

## Ведение логов
Логи записываются для всех основных операций, включая:

- Подключение к базе данных.
- Изменения в конфигурации устройства.
- Ошибки при подключении и обмене данными с устройствами.
- Процессы сканирования и автоматического подключения.


